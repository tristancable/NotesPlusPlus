@page "/folder/{folderName}"
@using Notes__.Utilities
@inject FolderService FolderService
@inject LayoutService LayoutService

<h3>@folderName Folder</h3>

<div>
    <div class="creation-button">
        <input @bind="newFileName" placeholder="Enter file name" />
        <button @onclick="CreateBasicFile">Create Basic File</button>
        <button @onclick="CreateBulletpointFile">Create Bulletpoint File</button>
        <button @onclick="CreateNumberedFile">Create Numbered File</button>
    </div>

    <ul class="file-list">
        @foreach (var file in files)
        {
            var fileNameWithoutExtension = Path.GetFileNameWithoutExtension(file);
            <li class="file-item">
                <a href="@($"/note/{folderName}/{fileNameWithoutExtension}")" class="file-link">
                    <i class="file-icon">
                        <i class="bi bi-file-earmark-text"></i>
                    </i>
                    @fileNameWithoutExtension
                </a>
            </li>
        }
    </ul>
</div>

@code {
    [Parameter] public string folderName { get; set; }

    private List<string> files = new();
    private string newFileName = string.Empty;

    protected override void OnParametersSet()
    {
        // Update the title to reflect the folder name
        LayoutService.PageTitle = folderName;

        files = FolderService.GetFilesInFolder(folderName);
    }

    protected override void OnInitialized()
    {
        files = FolderService.GetFilesInFolder(folderName);
    }

    private void CreateBasicFile()
    {
        if (!string.IsNullOrWhiteSpace(newFileName))
        {
            FolderService.CreateFileInFolder(folderName, newFileName);
            files = FolderService.GetFilesInFolder(folderName);
            newFileName = string.Empty;
            LayoutService.Format = LayoutService.EFormat.BASIC;
        }
    }

    private void CreateBulletpointFile()
    {
        if (!string.IsNullOrWhiteSpace(newFileName))
        {
            FolderService.CreateFileInFolder(folderName, $"{newFileName} - B");
            files = FolderService.GetFilesInFolder(folderName);
            newFileName = string.Empty;
            LayoutService.Format = LayoutService.EFormat.BULLETPOINT;
        }
    }

    private void CreateNumberedFile()
    {
        if (!string.IsNullOrWhiteSpace(newFileName))
        {
            FolderService.CreateFileInFolder(folderName, $"{newFileName} - N");
            files = FolderService.GetFilesInFolder(folderName);
            newFileName = string.Empty;
            LayoutService.Format = LayoutService.EFormat.NUMBERED;
        }
    }
}